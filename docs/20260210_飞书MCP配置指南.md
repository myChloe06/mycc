# 飞书 MCP 配置指南

**日期**：2026-02-10
**状态**：配置已完成，待用户填写凭证

---

## 概述

本项目已配置两个飞书 MCP 服务器，用于与飞书/Lark 平台集成：

1. **lark-mcp**：飞书官方 OpenAPI MCP
2. **feishu-mcp**：第三方飞书文档增强 MCP

---

## 配置文件位置

- **项目级配置**：`D:\Claude_Code\0131 mycc\.mcp.json`
- **用户级配置**：`C:\Users\my\.claude\settings.json`（用于全局设置）

---

## MCP 服务器详情

### 1. lark-mcp（官方）

- **NPM 包**：`@larksuiteoapi/lark-mcp`
- **版本**：0.5.1
- **仓库**：https://github.com/larksuite/lark-openapi-mcp
- **特点**：
  - 飞书官方维护
  - 封装了飞书开放平台 API
  - 支持文档处理、对话管理、日程等
  - 支持 tenant 和 user 两种认证模式

### 2. feishu-mcp（第三方）

- **NPM 包**：`feishu-mcp`
- **仓库**：https://github.com/cso1z/Feishu-MCP
- **本地路径**：`D:\Claude_Code\0131 mycc\temp-feishu-mcp`
- **特点**：
  - 功能更丰富，支持文档批量操作
  - 支持 Mermaid 图表、表格、公式
  - 支持画板内容创建
  - 支持知识库和文档库遍历

---

## 配置步骤

### 步骤 1：创建飞书应用

1. 访问[飞书开放平台](https://open.feishu.cn/)或 [Lark 开放平台](https://open.larksuite.com/)
2. 登录并点击"控制台"
3. 创建新应用
4. 获取 **App ID** 和 **App Secret**

### 步骤 2：配置应用权限

根据使用场景添加必要权限：

| 权限名称 | 权限值 | 说明 |
|---------|-------|------|
| 获取文档信息 | `docx:document` | 读取文档基本信息 |
| 创建文档 | `docx:document:create` | 创建新文档 |
| 编辑文档 | `docx:document:readonly` | 修改文档内容 |
| 文件夹访问 | `drive:drive` | 访问文件夹 |
| 搜索文档 | `drive:drive:readonly` | 搜索功能 |

### 步骤 3：更新配置文件

编辑 `D:\Claude_Code\0131 mycc\.mcp.json`，替换以下占位符：

```json
{
  "mcpServers": {
    "lark-mcp": {
      "command": "npx",
      "args": [
        "-y",
        "@larksuiteoapi/lark-mcp",
        "mcp",
        "-a",
        "cli_xxxxxxxxx",        // 替换为你的飞书 App ID
        "-s",
        "xxxxxxxxxxxxxx"        // 替换为你的飞书 App Secret
      ]
    },
    "feishu-mcp": {
      "command": "npx",
      "args": ["-y", "feishu-mcp@latest", "--stdio"],
      "env": {
        "FEISHU_APP_ID": "cli_xxxxxxxxx",     // 替换为你的飞书 App ID
        "FEISHU_APP_SECRET": "xxxxxxxxxxxxxx", // 替换为你的飞书 App Secret
        "FEISHU_AUTH_TYPE": "tenant"           // 或 "user"
      }
    }
  }
}
```

### 步骤 4：重启 Claude Code

配置完成后，重启 Claude Code 以加载 MCP 服务器：

```bash
# 关闭当前会话，重新启动
# 或在 Claude Code 中执行：/reload
```

---

## 认证模式说明

### Tenant 认证（应用级）

- **配置**：`FEISHU_AUTH_TYPE: "tenant"`
- **特点**：
  - 使用应用身份操作
  - 无需用户授权
  - 权限受应用配置限制
  - 适合自动化场景

### User 认证（用户级）

- **配置**：`FEISHU_AUTH_TYPE: "user"`
- **特点**：
  - 使用用户身份操作
  - 需要首次 OAuth 授权
  - 可以访问用户私有资源
  - 操作记录更真实
  - **推荐使用**

#### User 认证额外配置

如果使用 user 认证，需要先执行登录：

```bash
# 登录并获取用户访问令牌
npx -y @larksuiteoapi/lark-mcp login -a cli_xxxxx -s yyyyy

# 或指定 OAuth 范围
npx -y @larksuiteoapi/lark-mcp login -a cli_xxxxx -s yyyyy --scope offline_access docx:document
```

然后在配置中添加 `--oauth` 参数：

```json
{
  "args": [
    "-y",
    "@larksuiteoapi/lark-mcp",
    "mcp",
    "-a",
    "YOUR_APP_ID",
    "-s",
    "YOUR_APP_SECRET",
    "--oauth",
    "--token-mode",
    "user_access_token"
  ]
}
```

---

## 功能对比

| 功能 | lark-mcp（官方） | feishu-mcp（第三方） |
|-----|----------------|-------------------|
| 文档创建 | ✅ | ✅ |
| 文档读取 | ✅ | ✅ |
| 文档编辑 | ❌ 仅导入/读取 | ✅ 完整编辑 |
| 批量操作 | ❌ | ✅ |
| Mermaid 图表 | ❌ | ✅ |
| 表格创建 | ❌ | ✅ |
| 公式支持 | ❌ | ✅ |
| 画板内容 | ❌ | ✅ |
| 知识库支持 | ✅ | ✅ |
| API 覆盖 | 广泛 | 文档专精 |

---

## 使用建议

### 推荐场景

**使用 lark-mcp（官方）**：
- 需要调用飞书多种 API（消息、日历、联系人等）
- 需要官方支持和稳定更新
- 企业级应用场景

**使用 feishu-mcp（第三方）**：
- 主要处理文档操作
- 需要批量创建/编辑文档
- 需要图表、表格、公式等富文本功能
- 需要本地化部署

### 同时使用

两个 MCP 可以同时配置和使用，AI 会根据任务自动选择合适的工具。

---

## 故障排查

### 常见问题

**1. MCP 服务器无法启动**
- 检查 Node.js 是否已安装（需要 LTS 版本）
- 运行 `npx -v` 验证 npx 可用性

**2. 权限不足**
- 确认应用已添加所需权限
- 确认应用已发布
- 确认可用范围包含文档所有者

**3. 文档无法访问**
- 验证文档已授权给应用
- 使用 API Explorer 测试权限：
  - [获取 app_access_token](https://open.feishu.cn/api-explorer?apiName=app_access_token_internal&project=auth&resource=auth&version=v3)
  - [获取文档信息](https://open.feishu.cn/api-explorer?apiName=get&project=docx&resource=document&version=v1)

**4. User 认证失败**
- 确认已配置 OAuth 重定向 URL：`http://localhost:3000/callback`
- 确认已执行登录命令获取 token
- 检查权限配置是否包含 user 所需权限

---

## 域名配置

### 国内版飞书
- 默认使用 `https://open.feishu.cn`
- 无需额外配置

### 国际版 Lark
- 添加 `--domain` 参数：
  ```json
  {
    "args": [
      "-y",
      "@larksuiteoapi/lark-mcp",
      "mcp",
      "-a",
      "YOUR_APP_ID",
      "-s",
      "YOUR_APP_SECRET",
      "--domain",
      "https://open.larksuite.com"
    ]
  }
  ```

---

## 参考链接

- [飞书开放平台文档](https://open.feishu.cn/document/home/develop-a-bot-in-5-minutes/create-an-app)
- [lark-mcp GitHub](https://github.com/larksuite/lark-openapi-mcp)
- [feishu-mcp GitHub](https://github.com/cso1z/Feishu-MCP)
- [MCP 协议文档](https://modelcontextprotocol.io/introduction)

---

## 附录：配置验证

配置完成后，可以通过以下方式验证：

1. **检查 MCP 服务器状态**
   ```bash
   # 在 Claude Code 中执行
   /mcp list
   ```

2. **测试基本功能**
   - 尝试创建一个测试文档
   - 尝试读取已有文档

3. **查看日志**
   - 检查 Claude Code 输出中的 MCP 初始化信息
   - 确认服务器成功连接
